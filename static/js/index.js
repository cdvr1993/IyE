// Generated by CoffeeScript 1.8.0
(function() {
  var _check_cart, _update_indexes;

  $('#reg-form').bind('submit');

  window.register_new_user = function(event) {
    var pass;
    pass = $('#reg input[name=pass]').val();
    if (pass.length < 5) {
      alert('El password debe ser de al menos 5 carácteres');
      return event.preventDefault();
    } else if (pass !== $('#reg input[name=pass-re]').val()) {
      alert('Los passwords no coinciden');
      return event.preventDefault();
    }
  };

  _check_cart = function() {
    var data;
    data = new Object();
    $("#cart_body tr").each(function(key, row) {
      var delete_item, is_checked, name, new_qty;
      name = $(row).attr('name');
      data[name] = new Object();
      delete_item = true;
      new_qty = $(row).find("input[name='qty']").val();
      if (new_qty !== $(row).find("input#hidden_qty").val()) {
        data[name]['qty'] = $(row).find("input[name='qty']").val();
        delete_item = false;
      }
      is_checked = $(row).find("input[name='delete']")[0].checked;
      if (is_checked) {
        data[name]['delete'] = true;
        delete_item = false;
      }
      if (delete_item) {
        return delete data[name];
      }
    });
    return data;
  };

  _update_indexes = function(data) {
    var index, item, _i, _len, _results;
    _results = [];
    for (_i = 0, _len = data.length; _i < _len; _i++) {
      item = data[_i];
      index = 1;
      _results.push($("#cart_body tr").each(function(key, row) {
        if ($(row).attr('name') === item['id']) {
          item['id'] = index;
          return;
        }
        return index++;
      }));
    }
    return _results;
  };

  window.update_quantity = function() {
    var data;
    data = _check_cart();
    $.post('', {
      'csrfmiddlewaretoken': $("#form_cart input[name='csrfmiddlewaretoken']")[0].value,
      'data': JSON.stringify(data)
    }, function(data) {
      var html, html_content, item, msg, reload, _i, _len;
      $('div#alert_messages').remove();
      html = '<div id="alert_messages" onclick=\"$(this).remove();\">';
      msg = 0;
      reload = false;
      if (data[0]['id'] === void 0) {
        html_content = "<div class=\"alert-" + data[0].type + "\">" + data[0].info + "</div>";
        msg++;
      } else {
        html_content = '';
        _update_indexes(data);
        for (_i = 0, _len = data.length; _i < _len; _i++) {
          item = data[_i];
          html_content += "<div class=\"alert-" + item.type + "\">Producto " + item.id + ": " + item.info + "</div>";
          msg++;
          if (!reload && item.type === 'success') {
            reload = true;
          }
        }
      }
      html += "" + html_content + "</div>";
      if (msg > 0) {
        $('#id_main_section').append(html);
      }
      if (reload) {
        setTimeout(function() {
          return window.location.reload();
        }, 1200 * msg);
      }
      return null;
    });
    return null;
  };

  window.check_unisex = function() {
    if ($('#select_kind option:selected').attr('data-unisex') === 'True') {
      $('#select_gender').hide();
      return $('#label_gender').hide();
    } else {
      $('#select_gender').show();
      return $('#label_gender').show();
    }
  };

  window.get_colors = function() {
    var $gender, $kind;
    $gender = $('#select_gender');
    $kind = $('#select_kind');
    $('#product_price').text(' $' + $("#price_" + ($kind.val())).val());
    return $.get("/colors?kind=" + ($kind.val()) + "&gender=" + ($gender.val()), function(data) {
      var $div_colors, $select_colors, options, thumbnails;
      $div_colors = $('div#colors');
      $div_colors.empty();
      $select_colors = $('select#select_colors');
      if ($select_colors.length) {
        $select_colors.empty();
      }
      thumbnails = '';
      options = '';
      $(data).each(function() {
        var f;
        f = this.fields;
        thumbnails += '<img class="shirt" title="' + f.name + '" src="/static/img/store/color/' + f.image_name + '.jpg" />';
        if ($select_colors.length) {
          return options += '<option value="' + this.pk + '">' + f.name + '</option>';
        }
      });
      $div_colors.html(thumbnails);
      if ($select_colors.length) {
        return $select_colors.html(options);
      }
    });
  };

  window.checkout = function() {
    if (confirm("¿Seguro que desea realizar el pedido?") === true) {
      return $.post('/cart/checkout', {
        'csrfmiddlewaretoken': $("#form_checkout input[name='csrfmiddlewaretoken']").val()
      }, function(data) {
        var $div_msg, html;
        $div_msg = $('#msg_checkout');
        $div_msg.empty();
        if (data === 'True') {
          html = '<div class="alert alert-success" onclick="$(this).remove();">Pedido realizado con éxito</div>';
          setTimeout(function() {
            return window.location.reload();
          }, 2000);
        } else {
          html = '<div class="alert alert-error" onclick="$(this).remove();">' + 'Ocurrió un error a la hora de levantar el pedido</div>';
        }
        return $div_msg.append(html);
      });
    }
  };

}).call(this);
